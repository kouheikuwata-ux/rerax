generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model YearlyVision {
  id        String       @id @default(cuid())
  userId    String       @map("user_id")
  year      Int
  area      String       @default("private")
  title     String
  keywords  String?
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")
  goals     YearlyGoal[]

  @@unique([userId, year, area])
  @@index([userId])
  @@map("yearly_visions")
}

model YearlyGoal {
  id          String        @id @default(cuid())
  userId      String        @map("user_id")
  year        Int
  area        String        @default("private")
  title       String
  order       Int           @default(0)
  visionId    String?       @map("vision_id")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  monthThemes MonthTheme[]
  vision      YearlyVision? @relation(fields: [visionId], references: [id])

  @@index([userId, year, area])
  @@map("yearly_goals")
}

model MonthTheme {
  id           String      @id @default(cuid())
  userId       String      @map("user_id")
  month        String
  area         String      @default("private")
  title        String
  order        Int         @default(0)
  yearlyGoalId String?     @map("yearly_goal_id")
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  focusItems   FocusItem[]
  yearlyGoal   YearlyGoal? @relation(fields: [yearlyGoalId], references: [id])

  @@unique([userId, month, area, title])
  @@index([userId, month, area])
  @@map("month_themes")
}

model WeekPlan {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  weekStart String   @map("week_start")
  weekMap   String   @map("week_map")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@unique([userId, weekStart])
  @@index([userId])
  @@map("week_plans")
}

model FocusItem {
  id           String      @id @default(cuid())
  userId       String      @map("user_id")
  date         String
  area         String      @default("private")
  title        String
  duration     Int         @default(30)
  load         Int         @default(3)
  deadlineDate String?     @map("deadline_date")
  themeId      String?     @map("theme_id")
  intention    String?
  status       String      @default("planned")
  order        Int         @default(0)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  theme        MonthTheme? @relation(fields: [themeId], references: [id])

  @@index([userId, date, area])
  @@index([userId, status])
  @@map("focus_items")
}

model MindMapNode {
  id         String        @id @default(cuid())
  entityType String        @map("entity_type")
  entityId   String        @map("entity_id")
  parentId   String?       @map("parent_id")
  nodeType   String        @default("mindMapNode") @map("node_type")
  label      String
  positionX  Float         @map("position_x")
  positionY  Float         @map("position_y")
  width      Float?
  height     Float?
  color      String        @default("#94a3b8")
  createdAt  DateTime      @default(now()) @map("created_at")
  updatedAt  DateTime      @updatedAt @map("updated_at")
  parent     MindMapNode?  @relation("NodeHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children   MindMapNode[] @relation("NodeHierarchy")

  @@index([entityType, entityId])
  @@map("mind_map_nodes")
}

model ReflectionLog {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  date       String
  result     String
  reasonCode String?  @map("reason_code")
  note       String?
  createdAt  DateTime @default(now()) @map("created_at")

  @@unique([userId, date])
  @@index([userId])
  @@map("reflection_logs")
}
